<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ | One Piece</title>
<link rel="icon" href="data:," />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
Â  :root{
Â  Â  --bg-1: #1a1a1a; --bg-2: #121212; --glass-bg: rgba(255,255,255,0.03); --card: rgba(255,255,255,0.04);
Â  Â  --accent-a: #444; --accent-b: #222; --accent-c: #ffb86b; --muted: rgba(234, 234, 234, 0.6);
Â  Â  --text: #eaeaea; --radius: 16px; --glass-strong: rgba(255,255,255,0.06);
Â  }
Â  [data-theme="light"]{
Â  Â  --bg-1:#f3f7fb; --bg-2:#e6eef6; --glass-bg: rgba(11,27,43,0.04); --card: rgba(11,27,43,0.06);
Â  Â  --accent-a:#006cff; --accent-b:#00b37e; --accent-c:#ff7b2d; --muted: rgba(11,27,43,0.6);
Â  Â  --text:#071025; --glass-strong: rgba(11,27,43,0.04);
Â  }
Â  *{box-sizing:border-box}
Â  html{scroll-behavior:smooth}
Â  body{
Â  Â  min-height:100vh; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
Â  Â  color:var(--text);
Â  Â  background: radial-gradient(1000px at 15% 15%, rgba(255, 255, 255, 0.05), transparent 40%),
Â  Â  Â  Â  Â  Â  Â  Â  radial-gradient(800px at 85% 85%, rgba(255, 255, 255, 0.03), transparent 50%),
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(180deg,var(--bg-1), var(--bg-2));
Â  Â  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; padding:0;
Â  }
Â  .wrap{
Â  Â  width:100%; max-width:1200px; margin: 2rem auto; border-radius:22px; position:relative;
Â  Â  z-index: 1; padding:28px; overflow:hidden;
Â  Â  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
Â  Â  box-shadow: 0 12px 40px rgba(0,0,0,0.7); backdrop-filter: blur(14px) saturate(1.05);
Â  Â  display: none; /* Ğ˜Ğ—ĞĞĞ§ĞĞ›Ğ¬ĞĞ ĞŸĞĞĞ•Ğ›Ğ¬ Ğ¡ĞšĞ Ğ«Ğ¢Ğ */
Â  }
Â  header.top{ position:relative; z-index:5; display:flex; align-items:center; justify-content:space-between; gap:14px; margin-bottom:28px; }
Â  .brand{ display:flex; gap:14px; align-items:center; }
Â  .logo-badge{ width:56px;height:56px;border-radius:12px; background: linear-gradient(135deg,var(--accent-a), var(--accent-b)); display:flex;align-items:center;justify-content:center; font-weight:800; color:var(--text); font-size:18px; box-shadow: 0 8px 36px rgba(11,23,50,0.45); flex-shrink: 0; }
Â  .brand .title h1{margin:0;font-size:20px;letter-spacing:0.2px;}
Â  .controls-top{display:flex;gap:8px;align-items:center}
Â  .btn { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.04); padding:9px 14px;border-radius:12px;color:var(--text); cursor:pointer;font-weight:600;font-size:13px; backdrop-filter: blur(8px); transition: transform .15s ease, box-shadow .15s; white-space: nowrap; }
Â  .btn:hover{ transform:translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
Â  .btn.special-btn { background: var(--accent-c); color: var(--bg-1); font-weight: 800; border-color: transparent; }
Â  .btn.danger-btn { background: #c73434; color: white; }
Â  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50; background: linear-gradient(180deg, rgba(18,18,18,0.85), rgba(18,18,18,0.95)); backdrop-filter: blur(10px); }
Â  .modal.open{ display:flex; }
Â  .modal-card{ width:90%; max-width:780px; max-height:90vh; overflow-y:auto; border-radius:14px; padding:24px; background: var(--bg-1); border:1px solid rgba(255,255,255,0.05); box-shadow: 0 16px 50px rgba(0,0,0,0.5); }
Â  .modal-header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:20px }
Â  .modal-header h2 { margin: 0; }
Â  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
Â  .form-group { display: flex; flex-direction: column; gap: 8px; }
Â  .form-group.full-width { grid-column: 1 / -1; }
Â  .form-group label { font-weight: 600; font-size: 14px; color: var(--muted); }
Â  .form-input, .form-textarea { width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.08); background: rgba(0,0,0,0.2); color: var(--text); font-size: 14px; font-family: inherit; outline: none; transition: border-color .2s; }
Â  .form-input:focus, .form-textarea:focus { border-color: var(--accent-c); }
Â  .form-textarea { min-height: 100px; resize: vertical; }
Â  .form-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
Â  .table{ width:100%; border-collapse:collapse; font-size:14px; color:var(--muted) }
Â  .table th{ text-align:left; padding:12px 10px; color:var(--text); font-weight:700; border-bottom: 1px solid rgba(255,255,255,0.1); }
Â  .table td{ padding:12px 10px; border-top: 1px dashed rgba(255,255,255,0.04) }
Â  .table .action-cell { width: 180px; text-align: right; }
Â  .table tr:hover { background: rgba(255,255,255,0.02); }
</style>
</head>
<body data-theme="dark">

<div id="login-screen" style="display: flex; align-items: center; justify-content: center; min-height: 100vh; flex-direction: column; gap: 20px;">
Â  Â  <h1>Ğ’Ñ…Ğ¾Ğ´ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ</h1>
Â  Â  <button id="loginBtn" class="btn special-btn" style="font-size: 16px; padding: 12px 24px;">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Google</button>
</div>

<div class="wrap" role="main">
Â  <header class="top">
Â  Â  <div class="brand">
Â  Â  Â  <div class="logo-badge">ADM</div>
Â  Â  Â  <div class="title"><h1>ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞµÑ€Ğ¸ÑĞ¼Ğ¸</h1></div>
Â  Â  </div>
Â  Â  <div class="controls-top">
Â  Â  Â  <button id="addEpisodeBtn" class="btn special-btn">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ¸Ñ</button>
Â  Â  Â  <button id="logoutBtn" class="btn">Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</button> </div>
Â  </header>

Â  <section aria-label="Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ğ¾Ğ²">
Â  Â  Â  <table class="table" id="episodesTable" role="table">
Â  Â  Â  Â  <thead><tr><th>ID</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Ğ”Ğ°Ñ‚Ğ°</th><th class="action-cell">Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th></tr></thead>
Â  Â  Â  Â  <tbody id="episodesTableBody"></tbody>
Â  Â  Â  </table>
Â  </section>
</div>

<div id="editModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
Â  <div class="modal-card" role="document">
Â  Â  <form id="episodeForm">
Â  Â  Â  <input type="hidden" id="editId" value="">
Â  Â  Â  <div class="modal-header"><h2 id="modalTitle">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ¸Ñ</h2><button type="button" id="closeModal" class="btn">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button></div>
Â  Â  Â  <div class="form-grid">
Â  Â  Â  Â  Â  <div class="form-group"><label for="ep-id">ĞĞ¾Ğ¼ĞµÑ€ ÑĞµÑ€Ğ¸Ğ¸ (ID)</label><input type="number" id="ep-id" class="form-input" required></div>
Â  Â  Â  Â  Â  <div class="form-group"><label for="ep-date">Ğ”Ğ°Ñ‚Ğ° (Ğ“Ğ“Ğ“Ğ“-ĞœĞœ-Ğ”Ğ”)</label><input type="date" id="ep-date" class="form-input" required></div>
Â  Â  Â  Â  Â  <div class="form-group full-width"><label for="ep-title">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞµÑ€Ğ¸Ğ¸</label><input type="text" id="ep-title" class="form-input" required></div>
Â  Â  Â  Â  Â  <div class="form-group full-width"><label for="ep-thumb">Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ğ¿Ñ€ĞµĞ²ÑŒÑ (Thumbnail)</label><input type="url" id="ep-thumb" class="form-input"></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="form-group full-width"><label for="ep-iframe-dzen">Iframe Ğ¿Ğ»ĞµĞµÑ€Ğ° Dzen</label><textarea id="ep-iframe-dzen" class="form-textarea" placeholder="Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ´ <iframe ...>"></textarea></div>
Â  Â  Â  <div class="form-group full-width"><label for="ep-iframe-mega">Iframe Ğ¿Ğ»ĞµĞµÑ€Ğ° MEGA</label><textarea id="ep-iframe-mega" class="form-textarea" placeholder="Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ´ <iframe ...>"></textarea></div>
Â  Â  Â  <div class="form-group full-width"><label for="ep-iframe-kodik">Iframe Ğ¿Ğ»ĞµĞµÑ€Ğ° Kodik</label><textarea id="ep-iframe-kodik" class="form-textarea" placeholder="Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ´ <iframe ...>"></textarea></div>
Â  Â  Â  <div class="form-actions"><button type="button" id="cancelBtn" class="btn">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button><button type="submit" class="btn special-btn">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button></div>
Â  Â  </form>
Â  </div>
</div>

<script type="module">
Â  // --- FIREBASE: Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ ---
Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
Â  import { getFirestore, collection, doc, getDocs, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
Â  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";


Â  // --- FIREBASE: Ğ’Ğ°ÑˆĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ---
Â  const firebaseConfig = {
Â  Â  apiKey: "AIzaSyBE1AkNd3bPGPr3ZPUbtqNUd2WDCB2SHHw",
Â  Â  authDomain: "letovshiyori.firebaseapp.com",
Â  Â  projectId: "letovshiyori",
Â  Â  storageBucket: "letovshiyori.appspot.com",
Â  Â  messagingSenderId: "379203362104",
Â  Â  appId: "1:379203362104:web:20235be9bbbbfdbd6df5cd"
Â  };

Â  // --- FIREBASE: Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ---
Â  const app = initializeApp(firebaseConfig);
Â  const db = getFirestore(app);
Â  const auth = getAuth(app);
Â  const episodesCollection = collection(db, 'episodes');

Â  // --- Ğ›ĞĞ“Ğ˜ĞšĞ ĞĞ£Ğ¢Ğ•ĞĞ¢Ğ˜Ğ¤Ğ˜ĞšĞĞ¦Ğ˜Ğ˜ ---
Â  document.addEventListener('DOMContentLoaded', () => {

Â  Â  const loginScreen = document.getElementById('login-screen');
Â  Â  const loginBtn = document.getElementById('loginBtn');
Â  Â  const mainWrap = document.querySelector('.wrap');
Â  Â  let adminPanelInitialized = false; 

Â  Â  // ğŸ’¡ ĞĞĞ’ĞĞ•: Ğ£ĞºĞ°Ğ¶Ğ¸ Ğ·Ğ´ĞµÑÑŒ ÑĞ²Ğ¾Ğ¹ email Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
Â  Â  const allowedAdminEmail = 'musiclandbrd21@gmail.com'; 

Â  Â  // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° Ñ‡ĞµÑ€ĞµĞ· Google
Â  Â  const signIn = () => {
Â  Â  Â  Â  const provider = new GoogleAuthProvider();
Â  Â  Â  Â  signInWithPopup(auth, provider)
Â  Â  Â  Â  Â  Â  .catch((error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert(`ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸: ${error.message}`);
Â  Â  Â  Â  Â  Â  });
Â  Â  };

Â  Â  loginBtn.addEventListener('click', signIn);

Â  Â  // Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ»ÑĞ´Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
Â  Â  onAuthStateChanged(auth, user => {
Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  // ğŸ’¡ ĞĞĞ’ĞĞ•: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ¿Ğ¾ email
Â  Â  Â  Â  Â  Â  if (user.email === allowedAdminEmail) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ğ¾ÑˆĞµĞ»:", user.displayName);
Â  Â  Â  Â  Â  Â  Â  Â  loginScreen.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  mainWrap.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  if (!adminPanelInitialized) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  initializeAdminPanel();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adminPanelInitialized = true;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¾ÑˆĞµĞ», Ğ½Ğ¾ ĞµĞ³Ğ¾ email Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Ğ’Ñ…Ğ¾Ğ´ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ:", user.email);
Â  Â  Â  Â  Â  Â  Â  Â  alert("Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸.");
Â  Â  Â  Â  Â  Â  Â  Â  signOut(auth); // ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ¸Ğ· ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹ÑˆĞµĞ» Ğ¸Ğ· ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ·Ğ°Ñ…Ğ¾Ğ´Ğ¸Ğ»
Â  Â  Â  Â  Â  Â  console.log("ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.");
Â  Â  Â  Â  Â  Â  loginScreen.style.display = 'flex';
Â  Â  Â  Â  Â  Â  mainWrap.style.display = 'none';
Â  Â  Â  Â  Â  Â  adminPanelInitialized = false; 
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // --- Ğ›ĞĞ“Ğ˜ĞšĞ ĞĞ”ĞœĞ˜Ğ-ĞŸĞĞĞ•Ğ›Ğ˜ ---
Â  Â  function initializeAdminPanel() {
Â  Â  Â  Â  let episodes = [];
Â  Â  Â  Â  const tableBody = document.getElementById('episodesTableBody');
Â  Â  Â  Â  const modal = document.getElementById('editModal');
Â  Â  Â  Â  const form = document.getElementById('episodeForm');
Â  Â  Â  Â  const modalTitle = document.getElementById('modalTitle');
Â  Â  Â  Â  const addEpisodeBtn = document.getElementById('addEpisodeBtn');
Â  Â  Â  Â  const closeModalBtn = document.getElementById('closeModal');
Â  Â  Â  Â  const cancelBtn = document.getElementById('cancelBtn');
Â  Â  Â  Â  const editIdInput = document.getElementById('editId');
Â  Â  Â  Â  const logoutBtn = document.getElementById('logoutBtn');

Â  Â  Â  Â  const logOut = () => {
Â  Â  Â  Â  Â  Â  signOut(auth).catch(error => console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ°:", error));
Â  Â  Â  Â  };
Â  Â  Â  Â  logoutBtn.addEventListener('click', logOut);


Â  Â  Â  Â  async function loadEpisodes() {
Â  Â  Â  Â  Â  Â  tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;padding:2rem;">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑĞµÑ€Ğ¸Ğ¹...</td></tr>`;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const querySnapshot = await getDocs(episodesCollection);
Â  Â  Â  Â  Â  Â  Â  Â  episodes = [];
Â  Â  Â  Â  Â  Â  Â  Â  querySnapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  episodes.push({ firestoreId: doc.id, ...doc.data() });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  renderTable();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑĞµÑ€Ğ¸Ğ¹ Ğ¸Ğ· Firestore: ", error);
Â  Â  Â  Â  Â  Â  Â  Â  tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;padding:2rem;color:var(--accent-c);">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ.</td></tr>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderTable() {
Â  Â  Â  Â  Â  Â  tableBody.innerHTML = '';
Â  Â  Â  Â  Â  Â  if (episodes.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;padding:2rem;">Ğ¡ĞµÑ€Ğ¸Ğ¹ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ¸Ñ", Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ.</td></tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const sortedEpisodes = [...episodes].sort((a, b) => b.id - a.id);
Â  Â  Â  Â  Â  Â  sortedEpisodes.forEach(ep => {
Â  Â  Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><strong>${ep.id}</strong></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${ep.title}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${ep.date}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="action-cell">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn edit-btn" data-id="${ep.firestoreId}">Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn danger-btn delete-btn" data-id="${ep.firestoreId}">Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>`;
Â  Â  Â  Â  Â  Â  Â  Â  tableBody.appendChild(tr);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function openModal(episodeId = null) {
Â  Â  Â  Â  Â  Â  form.reset();
Â  Â  Â  Â  Â  Â  document.getElementById('ep-id').readOnly = false;
Â  Â  Â  Â  Â  Â  editIdInput.value = episodeId || '';

Â  Â  Â  Â  Â  Â  if (episodeId) {
Â  Â  Â  Â  Â  Â  Â  Â  modalTitle.textContent = "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞµÑ€Ğ¸Ñ";
Â  Â  Â  Â  Â  Â  Â  Â  const ep = episodes.find(e => e.firestoreId === episodeId);
Â  Â  Â  Â  Â  Â  Â  Â  if (ep) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ep-id').value = ep.id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ep-id').readOnly = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ep-title').value = ep.title;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ep-date').value = ep.date;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ep-thumb').value = ep.thumb || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ep-iframe-dzen').value = ep.players.dzen || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ep-iframe-mega').value = ep.players.mega || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ep-iframe-kodik').value = ep.players.kodik || '';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  modalTitle.textContent = "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ÑĞµÑ€Ğ¸Ñ";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  modal.classList.add('open');
Â  Â  Â  Â  Â  Â  modal.setAttribute('aria-hidden', 'false');
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeModal() {
Â  Â  Â  Â  Â  Â  modal.classList.remove('open');
Â  Â  Â  Â  Â  Â  modal.setAttribute('aria-hidden', 'true');
Â  Â  Â  Â  }

Â  Â  Â  Â  async function handleFormSubmit(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const episodeIdValue = document.getElementById('ep-id').value;
Â  Â  Â  Â  Â  Â  if (!episodeIdValue) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("ĞĞ¾Ğ¼ĞµÑ€ ÑĞµÑ€Ğ¸Ğ¸ (ID) ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ»ĞµĞ¼.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const episodeData = {
Â  Â  Â  Â  Â  Â  Â  Â  id: parseInt(episodeIdValue, 10),
Â  Â  Â  Â  Â  Â  Â  Â  title: document.getElementById('ep-title').value,
Â  Â  Â  Â  Â  Â  Â  Â  date: document.getElementById('ep-date').value,
Â  Â  Â  Â  Â  Â  Â  Â  thumb: document.getElementById('ep-thumb').value,
Â  Â  Â  Â  Â  Â  Â  Â  quality: "1080p",
Â  Â  Â  Â  Â  Â  Â  Â  players: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dzen: document.getElementById('ep-iframe-dzen').value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mega: document.getElementById('ep-iframe-mega').value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  kodik: document.getElementById('ep-iframe-kodik').value
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  const docId = String(episodeData.id);
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "episodes", docId), episodeData);
Â  Â  Â  Â  Â  Â  Â  Â  closeModal();
Â  Â  Â  Â  Â  Â  Â  Â  await loadEpisodes();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸ ÑĞµÑ€Ğ¸Ğ¸: ", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ¸Ñ. Ğ¡Ğ¼. ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  addEpisodeBtn.addEventListener('click', () => openModal());

Â  Â  Â  Â  tableBody.addEventListener('click', async (e) => {
Â  Â  Â  Â  Â  Â  const target = e.target;
Â  Â  Â  Â  Â  Â  const episodeId = target.getAttribute('data-id');
Â  Â  Â  Â  Â  Â  if (target.classList.contains('edit-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  openModal(episodeId);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (target.classList.contains('delete-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  const episodeToDelete = episodes.find(ep => ep.firestoreId === episodeId);
Â  Â  Â  Â  Â  Â  Â  Â  if (episodeToDelete && confirm(`Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ "${episodeToDelete.title}"?`)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "episodes", episodeId));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await loadEpisodes();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞµÑ€Ğ¸Ğ¸: ", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ¸Ñ. Ğ¡Ğ¼. ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  form.addEventListener('submit', handleFormSubmit);
Â  Â  Â  Â  closeModalBtn.addEventListener('click', closeModal);
Â  Â  Â  Â  cancelBtn.addEventListener('click', closeModal);
Â  Â  Â  Â  modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
Â  Â  Â  Â  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.classList.contains('open')) { closeModal(); } });
Â  Â  Â  Â  
Â  Â  Â  Â  loadEpisodes();
Â  Â  }
Â  });
</script>
</body>
</html>
