<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title> Ван-Пис в озвучке Макс Летов & ShiYori (Modern)</title>
<link rel="icon" href="data:," />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-1: #1a1a1a;
    --bg-2: #121212;
    --glass-bg: rgba(255,255,255,0.03);
    --card: rgba(255,255,255,0.04);
    --accent-a: #444;
    --accent-b: #222;
    --accent-c: #ffb86b;
    --muted: rgba(234, 234, 234, 0.6);
    --text: #eaeaea;
    --radius: 16px;
    --glass-strong: rgba(255,255,255,0.06);
  }
  [data-theme="light"]{
    --bg-1:#f3f7fb;
    --bg-2:#e6eef6;
    --glass-bg: rgba(11,27,43,0.04);
    --card: rgba(11,27,43,0.06);
    --accent-a:#006cff;
    --accent-b:#00b37e;
    --accent-c:#ff7b2d;
    --muted: rgba(11,27,43,0.6);
    --text:#071025;
    --glass-strong: rgba(11,27,43,0.04);
  }

  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{
    min-height:100vh;
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--text);
    background: radial-gradient(1000px at 15% 15%, rgba(255, 255, 255, 0.05), transparent 40%),
                radial-gradient(800px at 85% 85%, rgba(255, 255, 255, 0.03), transparent 50%),
                linear-gradient(180deg,var(--bg-1), var(--bg-2));
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:0;
  }

  .site-banner {
    width: 100%;
    height: 400px;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 0;
    background: url('https://i.ibb.co/LzP144Q1/cover-b7dce2b45b7afcef804ec3b61333f53d-waifu2x-art-noise1-scale.png') no-repeat center center;
    background-size: cover;
    mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 60%, rgba(0,0,0,0) 100%);
    -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 60%, rgba(0,0,0,0) 100%);
  }
  
  .social-links-bar {
    position: absolute;
    top: 190px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2;
    display: flex;
    gap: 12px;
    align-items: center;
    padding: 1rem;
  }
  
  a.btn {
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  
  .btn.special-btn {
    background: var(--accent-c);
    color: var(--bg-1);
    font-weight: 800;
    border-color: transparent;
    transform: scale(1.05);
  }
  .btn.special-btn:hover {
    box-shadow: 0 8px 25px rgba(255, 184, 107, 0.3);
    transform: translateY(-3px) scale(1.08);
  }

  .wrap{
    width:100%;
    max-width:1200px;
    margin: 250px auto 2rem;
    border-radius:22px;
    position:relative;
    z-index: 1;
    padding:28px;
    overflow:hidden;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: 0 12px 40px rgba(0,0,0,0.7);
    backdrop-filter: blur(14px) saturate(1.05);
  }

  .hero-glow{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    top:-80px;
    width:88%;
    height:320px;
    pointer-events:none;
    filter: blur(46px) saturate(1.2);
    background: radial-gradient(closest-side, rgba(255, 255, 255, 0.06), transparent 70%);
    border-radius:40%;
    z-index:0;
    opacity:0.95;
  }

  header.top{
    position:relative;
    z-index:5;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
    margin-bottom:18px;
  }
  .brand{
    display:flex; gap:14px; align-items:center;
  }
  .logo-badge{
    width:56px;height:56px;border-radius:12px;
    background: linear-gradient(135deg,var(--accent-a), var(--accent-b));
    display:flex;align-items:center;justify-content:center;
    font-weight:800;
    color:var(--text);
    font-size:18px;
    box-shadow: 0 8px 36px rgba(11,23,50,0.45);
    flex-shrink: 0;
  }
  .brand .title{
    line-height:1;
  }
  .brand h1{margin:0;font-size:20px;letter-spacing:0.2px;}
  .brand p{margin:0;color:var(--muted); font-size:13px}

  .controls-top{display:flex;gap:8px;align-items:center}
  .btn {
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    padding:9px 14px;border-radius:12px;color:var(--text);
    cursor:pointer;font-weight:600;font-size:13px;
    backdrop-filter: blur(8px);
    transition: transform .15s ease, box-shadow .15s;
    white-space: nowrap;
  }
  .btn:hover{ transform:translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
  .btn.ghost{ background:transparent;border:1px solid rgba(255,255,255,0.06);}

  .hero{
    display:grid; grid-template-columns: 1fr 360px; gap:22px; align-items:start;
    position:relative; z-index:6;
  }

  .player-card{
    border-radius:18px;
    padding:20px;
    position:relative;
    transform-style:preserve-3d;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 24px 60px rgba(2,6,23,0.6);
    backdrop-filter: blur(12px) saturate(1.1);
    transition: transform .25s ease;
    overflow:visible;
  }

  .player-float{
    position:absolute; inset: -24px -24px auto -24px; height:calc(100% + 48px);
    pointer-events:none;
    background: linear-gradient(120deg, rgba(255,255,255,0.05), rgba(255,255,255,0.04));
    border-radius:22px;
    filter: blur(28px);
    z-index:-1;
  }

  .player-wrap{
    width:100%;
    border-radius:12px;
    overflow:hidden;
    display:block;
    box-shadow: 0 10px 30px rgba(2,6,23,0.5);
    transform-origin:center;
    animation: levitate 6s ease-in-out infinite;
  }
  @keyframes levitate{
    0%{ transform: translateY(0px) rotateZ(-0.2deg) }
    50%{ transform: translateY(-10px) rotateZ(0.2deg) }
    100%{ transform: translateY(0px) rotateZ(-0.2deg) }
  }

  .embed {
    width:100%;
    aspect-ratio: 16 / 9;
    background: #000;
    border-radius:10px;
    overflow:hidden;
    border: 1px solid rgba(255,255,255,0.03);
  }
  .embed iframe{ width:100%; height:100%; border:0; display:block; }

  .meta-card{
    border-radius:14px;
    padding:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.035);
    backdrop-filter: blur(10px);
  }
  .meta-card h3{ margin:0 0 6px 0; font-size:15px }
  .meta-row{ color:var(--muted); font-size:13px; margin-bottom:10px }

  #player-controls { display:flex;justify-content:space-between;align-items:center;margin-top:12px; }
  .player-title{ font-weight:700; font-size:16px; margin-top:8px; }
  .player-sub{ color:var(--muted); font-size:13px; margin-top:4px; }

  .nav-row{ display:flex; gap:8px; margin-top:12px; }
  .pill{ display:inline-flex; gap:8px; align-items:center; padding:8px 10px; border-radius:999px; font-weight:600; font-size:13px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); cursor:pointer; }
  
  .player-select-wrapper {
    margin-top: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    color: var(--muted);
  }

  .custom-select {
    position: relative;
    display: inline-block;
  }

  .custom-select::after {
    content: '▾';
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    color: var(--muted);
    font-size: 16px;
  }

  .custom-select select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    padding: 9px 32px 9px 14px;
    border-radius: 12px;
    color: var(--text);
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    font-family: inherit;
    min-width: 150px;
  }

  /* ИСПРАВЛЕНИЕ: Цвет текста в выпадающем списке для темной темы */
  [data-theme="dark"] .custom-select option {
      background: white;
      color: black;
  }

  .playlist-area{
    margin-top:20px;
    display:flex;
    gap:18px;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  .left-list{ flex:1; min-width:300px }
  .list-controls{ display:flex; gap:10px; align-items:center; margin-bottom:10px }
  .search{
    flex:1;
    padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);
    background:transparent;color:var(--text);font-size:14px;
    outline:none;
  }
  .episodes-grid{
    display:grid;
    grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
    gap:12px;
    max-height:340px;
    overflow:auto;
    padding:6px;
  }
  .ep{
    display:flex; gap:12px; align-items:center;
    padding:12px;border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    cursor:pointer; transition: transform .12s, box-shadow .12s;
  }
  .ep:hover{ transform: translateY(-6px); box-shadow: 0 16px 40px rgba(2,6,23,0.45); }
  .ep .thumb{
    width:96px;height:54px;border-radius:8px;background:#0b1720;display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700;
    flex-shrink:0; font-size:12px;
    overflow:hidden;
  }
  .ep .meta{ display:flex;flex-direction:column; gap:6px }
  .ep .meta .t{ font-weight:700; font-size:14px }
  .ep .meta .s{ font-size:12px; color:var(--muted) }

  .ep.active{
    outline: 2px solid rgba(255,185,107,0.9);
    box-shadow: 0 12px 40px rgba(255,177,107,0.06) inset;
  }

  .modal{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50;
    background: linear-gradient(180deg, rgba(18,18,18,0.85), rgba(18,18,18,0.95));
    backdrop-filter: blur(10px);
  }
  .modal.open{ display:flex; }
  .modal-card{
    width:90%; max-width:980px; max-height:80vh; overflow:auto; border-radius:14px; padding:18px;
    background: var(--bg-1);
    border:1px solid rgba(255,255,255,0.05);
  }
  .modal-header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px }
  .table{ width:100%; border-collapse:collapse; font-size:14px; color:var(--muted) }
  .table th{ text-align:left; padding:8px 10px; color:var(--text); font-weight:700 }
  .table td{ padding:8px 10px; border-top: 1px dashed rgba(255,255,255,0.04) }
  .table .action-cell { width: 140px; text-align: right; }

  footer.note{ margin-top:18px; color:var(--muted); font-size:13px; text-align:center }

  @media (max-width:980px){
    .hero{ grid-template-columns:1fr }
    .meta-card{ order:2 }
    .player-card{ order:1 }
    .hero-glow{ top:-60px; height:220px }
    .social-links-bar {
      top: 150px;
      padding: 0.5rem;
      gap: 8px;
    }
    .social-links-bar .btn {
      font-size: 12px;
      padding: 8px 12px;
    }
    .wrap {
      margin-top: 220px;
    }
  }

  @media (max-width: 767px) {
    .wrap {
      padding: 16px;
      margin: 200px auto 1rem;
    }

    .site-banner {
      height: 300px;
    }
    
    .social-links-bar {
      top: 130px;
      flex-wrap: wrap;
      justify-content: center;
    }

    header.top {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }

    .brand h1 {
      font-size: 18px;
    }

    #player-controls {
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
    }
    #player-controls > div:last-child {
        display: flex;
        justify-content: space-between;
        gap: 8px;
    }
    #player-controls .btn {
        flex-grow: 1;
        justify-content: center;
    }

    .episodes-grid {
      grid-template-columns: 1fr;
    }

    .left-list {
      min-width: 100%;
    }
    .list-controls {
      flex-direction: column;
      align-items: stretch;
    }

    .modal-card {
      padding: 12px;
    }
    .modal-header {
      flex-direction: column;
      align-items: flex-start;
    }

    #modalSearch {
      width: 100%;
    }

    .table th, .table td {
        font-size: 12px;
        padding: 8px 4px;
    }
    
    .table th:nth-child(2), .table td:nth-child(2) {
      max-width: 120px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .table .action-cell { width: auto; }
  }

</style>
</head>
<body data-theme="dark">

  <div class="site-banner" role="banner"></div>

  <nav class="social-links-bar">
    <a href="https://t.me/maxletovv_dub" target="_blank" rel="noopener noreferrer" class="btn">Telegram</a>
    <a href="https://t.me/boost/maxletovv_dub" target="_blank" rel="noopener noreferrer" class="btn">Буст ТГ</a>
    <a href="https://www.tiktok.com/@max.letovv_dub" target="_blank" rel="noopener noreferrer" class="btn">TikTok</a>
    <a href="https://donatty.com/onepiece_letovshiyori" target="_blank" rel="noopener noreferrer" class="btn special-btn">Поддержать проект</a>
  </nav>

  <div class="wrap" role="main" aria-label="One Piece — озвучка">
    <div class="hero-glow" aria-hidden="true"></div>

    <header class="top">
      <div class="brand">
        <div class="logo-badge">ML</div>
        <div class="title">
          <h1>Ван-Пис в озвучке Макс Летов & ShiYori</h1>
          <p>Новая серия каждое воскресенье!</p>
        </div>
      </div>
      <div class="controls-top">
        <button id="themeBtn" class="btn ghost" title="Переключить тему">Тема</button>
        <button id="allBtn" class="btn" title="Показать все серии">Все серии ▾</button>
      </div>
    </header>

    <section class="hero" aria-labelledby="playerTitle">
      <div class="player-card" role="region" aria-label="Плеер">
        <div class="player-float" aria-hidden="true"></div>
        <div class="player-wrap">
          <div id="playerEmbed" class="embed" aria-live="polite"></div>
        </div>
        <div id="player-controls">
          <div>
            <div id="playerTitle" class="player-title">Загрузка...</div>
            <div id="playerSub" class="player-sub">—</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="prevBtn" class="btn">◀ Назад</button>
            <button id="nextBtn" class="btn">Вперёд ▶</button>
            <button id="pipBtn" class="btn">PIP</button>
          </div>
        </div>
        
        <div class="player-select-wrapper">
          <label for="playerSource">Выбор плеера:</label>
          <div class="custom-select">
            <select id="playerSource" name="playerSource">
              <option value="mega">MEGA</option>
              <option value="dzen" selected>Dzen</option>
              <option value="kodik">Kodik</option>
            </select>
          </div>
        </div>

      </div>

      <aside class="meta-card" aria-label="Информация о выпуске">
        <h3>О серии</h3>
        <div class="meta-row" id="metaText">Выбери эпизод из списка.</div>
        <div class="nav-row">
          <div class="pill" id="shareBtn" title="Скопировать ссылку">Поделиться</div>
        </div>
        <div style="height:10px"></div>
        <div>
          <div style="font-weight:700;font-size:13px;margin-bottom:6px">Подписаться</div>
          <div style="display:flex;gap:8px">
            <a href="https://t.me/maxletovv_dub" target="_blank" rel="noopener noreferrer" class="btn">Telegram</a>
          </div>
        </div>
        <div style="height:18px; border-bottom: 1px solid rgba(255,255,255,0.05); margin: 18px 0;"></div>
        <h3>О канале</h3>
        <div class="meta-row">Тут можно узнать о моей жизни, послушать стихи, или в целом узнать о том, чем я занимаюсь.
        <br><br>
        https://t.me/boost/maxletovv_dub
        <br>
        https://www.tiktok.com/@max.letovv_dub</div>
      </aside>
    </section>

    <section class="playlist-area" aria-label="Список эпизодов">
      <div class="left-list">
        <div class="list-controls">
          <input id="search" class="search" placeholder="Поиск по названию..." aria-label="Поиск по эпизодам">
          <button id="toggleAll" class="btn ghost">Показать все</button>
        </div>
        <div class="episodes-grid" id="episodesGrid" tabindex="0" aria-live="polite"></div>
      </div>
    </section>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-header">
        <h2 style="margin:0">Все серии</h2>
        <div style="display:flex;gap:8px; width: 100%; max-width: 400px;">
          <input id="modalSearch" class="search" placeholder="Фильтр..." style="flex-grow: 1;">
          <button id="closeModal" class="btn">Закрыть</button>
        </div>
      </div>
      <table class="table" id="allTable" role="table">
        <thead>
          <tr><th>EP</th><th>Название</th><th>Дата</th><th>Качество</th><th></th></tr>
        </thead>
        <tbody id="allTbody"></tbody>
      </table>
    </div>
  </div>

<script>
const episodes = [
  { id:1138, title: "Эпизод 1138", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30Zzym4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1137, title: "Эпизод 1137", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30ZMym4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1136, title: "Эпизод 1136", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30Ydym4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1135, title: "Эпизод 1135", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30b8yW4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1134, title: "Эпизод 1134", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30bqyW4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1133, title: "Эпизод 1133", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30bMyW4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1132, title: "Эпизод 1132", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30avyW4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1131, title: "Эпизод 1131", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30Z-yW4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1130, title: "Эпизод 1130", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30ZgyW4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1129, title: "Эпизод 1129", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30ZTyW4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1128, title: "Эпизод 1128", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30b3yG4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1137, title: "Эпизод 1127", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30bnyG4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1126, title: "Эпизод 1126", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30auyG4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1125, title: "Эпизод 1125", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30ZWyG4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1124, title: "Эпизод 1124", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30ZNyG4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },
  { id:1123, title: "Эпизод 1123", iframe: `<iframe width="480" height="270" src="https://dzen.ru/embed/o30ZNyG4IAAA?from_block=partner&from=zen&mute=0&autoplay=0&tv=0" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" data-testid="embed-iframe" frameborder="0" scrolling="no" allowfullscreen></iframe>`, date:"2025-08-10", quality:"1080p", thumb:"https://storage.donatty.com/d17ea7f6-5bbb-42be-97a9-dbba46b93cc8/cover_b7dce2b45b7afcef804ec3b61333f53d.jpg" },

let currentIndex = 0;
let autoNext = false;

const episodesGrid = document.getElementById('episodesGrid');
const playerEmbed = document.getElementById('playerEmbed');
const playerTitle = document.getElementById('playerTitle');
const playerSub = document.getElementById('playerSub');
const metaText = document.getElementById('metaText');
const search = document.getElementById('search');
const allBtn = document.getElementById('allBtn');
const modal = document.getElementById('modal');
const allTbody = document.getElementById('allTbody');
const modalSearch = document.getElementById('modalSearch');

function renderList(filter = ''){
  episodesGrid.innerHTML = '';
  const term = filter.trim().toLowerCase();
  episodes.forEach((ep, idx) => {
    if(term && !(ep.title.toLowerCase().includes(term) || String(ep.id).includes(term))) return;
    const el = document.createElement('div');
    el.className = 'ep';
    el.tabIndex = 0;
    el.setAttribute('role','button');
    el.innerHTML = `
      <div class="thumb" aria-hidden="true">
        ${ ep.thumb ? `<img src="${ep.thumb}" alt="" style="width:100%;height:100%;object-fit:cover">` : `EP ${ep.id}` }
      </div>
      <div class="meta">
        <div class="t">${ep.title}</div>
        <div class="s">${ep.date} • ${ep.quality}</div>
      </div>
    `;
    el.onclick = ()=> loadEpisode(idx);
    el.onkeypress = (e)=> { if(e.key === 'Enter') loadEpisode(idx) };
    episodesGrid.appendChild(el);
  });
  markActive();
}

function loadEpisode(idx, autoplay=false){
  if(idx < 0 || idx >= episodes.length) return;
  currentIndex = idx;
  const ep = episodes[idx];
  playerEmbed.innerHTML = ep.iframe;
  playerTitle.textContent = ep.title;
  playerSub.textContent = `${ep.date} • ${ep.quality}`;
  metaText.textContent = `EP ${ep.id} • Загружено: ${ep.date}`;
  markActive();
}

function markActive(){
  const nodes = Array.from(episodesGrid.children);
  nodes.forEach((n,i)=>{
    if(i === currentIndex) n.classList.add('active'); else n.classList.remove('active');
  });
}

document.getElementById('prevBtn').addEventListener('click', ()=> {
  if(currentIndex > 0) loadEpisode(currentIndex - 1, true);
});
document.getElementById('nextBtn').addEventListener('click', ()=> {
  if(currentIndex < episodes.length - 1) loadEpisode(currentIndex + 1, true);
});

document.getElementById('pipBtn').addEventListener('click', async ()=>{
  try{
    const ifr = playerEmbed.querySelector('iframe');
    if(!ifr) throw new Error('Нет iframe для PIP');
    alert('PIP может работать только для встроенных видео/видео того же источника. Попробуй на YouTube кнопку «Картинка в картинке» в контекстном меню плеера.');
  }catch(e){
    console.warn(e);
    alert('PIP недоступен для этого источника.');
  }
});

search.addEventListener('input', (e)=> renderList(e.target.value));

allBtn.addEventListener('click', ()=> openModal());
function openModal(){
  renderModalTable('');
  modal.classList.add('open');
  modal.setAttribute('aria-hidden','false');
  modalSearch.focus();
}
document.getElementById('closeModal').addEventListener('click', closeModal);
modal.addEventListener('click', (e)=> { if(e.target === modal) closeModal(); });
function closeModal(){
  modal.classList.remove('open');
  modal.setAttribute('aria-hidden','true');
}

function renderModalTable(filter=''){
  allTbody.innerHTML = '';
  const q = filter.trim().toLowerCase();
  episodes.forEach((ep, idx)=>{
    if(q && !(String(ep.id).includes(q) || ep.title.toLowerCase().includes(q))) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="width:70px"><strong>${ep.id}</strong></td>
      <td>${ep.title}</td>
      <td style="width:120px">${ep.date}</td>
      <td style="width:80px">${ep.quality}</td>
      <td class="action-cell"><button class="btn" data-idx="${idx}">Смотреть</button></td>
    `;
    allTbody.appendChild(tr);
  });
  Array.from(allTbody.querySelectorAll('button')).forEach(b=>{
    b.onclick = ()=> {
      const idx = Number(b.getAttribute('data-idx'));
      loadEpisode(idx);
      closeModal();
      episodesGrid.children[idx]?.scrollIntoView({behavior:'smooth', block:'center'});
    };
  });
}
modalSearch.addEventListener('input', (e)=> renderModalTable(e.target.value));

modalSearch.addEventListener('keydown',(e)=>{ if(e.key === 'Enter') { const q=e.target.value; renderModalTable(q); } });

document.getElementById('shareBtn').addEventListener('click', ()=>{
  const ep = episodes[currentIndex];
  if(!ep) return alert('Эпизод не выбран');
  const m = ep.iframe.match(/src="([^"]+)"/);
  const url = m ? m[1] : window.location.href;
  navigator.clipboard?.writeText(url).then(()=> alert('Ссылка скопирована в буфер обмена'), ()=> alert('Не удалось скопировать ссылку'));
});

document.getElementById('themeBtn').addEventListener('click', ()=>{
  const body = document.body;
  const currentTheme = body.getAttribute('data-theme') || 'dark';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  body.setAttribute('data-theme', newTheme);
});


document.getElementById('toggleAll').addEventListener('click', openModal);

document.addEventListener('keydown', (e)=> {
  if(e.key === 'Escape') {
    if(modal.classList.contains('open')) closeModal();
  }
});

renderList();
renderModalTable();
loadEpisode(0);

</script>
</body>

</html>

